# ç­–ç•¥ç®¡ç†ç³»ç»Ÿå®æ–½æ€»ç»“

## æ¦‚è¿°

å·²æˆåŠŸå®ç°å®Œæ•´çš„ç­–ç•¥ç®¡ç†ç³»ç»Ÿï¼Œå…è®¸é€šè¿‡ Web Manager ç®¡ç†ç­–ç•¥ï¼ŒConsole åº”ç”¨ç¨‹åºè‡ªåŠ¨ä»æ•°æ®åº“åŠ è½½å’Œæ‰§è¡Œç­–ç•¥ï¼Œå¹¶ä¿å­˜è®¢å•å’Œ PnL æ•°æ®ã€‚

## å®æ–½çš„åŠŸèƒ½

### âœ… 1. æ•°æ®åº“ Schema æ›´æ–°

#### Strategy Entity å¢å¼º
**æ–‡ä»¶**: `packages/data-manager/src/entities/Strategy.ts`

æ–°å¢å­—æ®µï¼š
- `description?: string` - ç­–ç•¥æè¿°
- `type: StrategyType` - ç­–ç•¥ç±»å‹ (moving_average, rsi, macd, bollinger_bands, custom)
- `status: StrategyStatus` - çŠ¶æ€ (active, stopped, paused, error)
- `exchange?: string` - äº¤æ˜“æ‰€
- `symbol?: string` - äº¤æ˜“å¯¹
- `errorMessage?: string` - é”™è¯¯ä¿¡æ¯
- `lastExecutionTime?: Date` - æœ€åæ‰§è¡Œæ—¶é—´

æ–°å¢ Enumï¼š
- `StrategyStatus`: ACTIVE, STOPPED, PAUSED, ERROR
- `StrategyType`: MOVING_AVERAGE, RSI, MACD, BOLLINGER_BANDS, CUSTOM

æ–°å¢ç´¢å¼•ï¼š
- `status` å­—æ®µç´¢å¼•ï¼ˆç”¨äºå¿«é€ŸæŸ¥è¯¢æ´»è·ƒç­–ç•¥ï¼‰
- `exchange` å­—æ®µç´¢å¼•

#### Order Entity å¢å¼º
**æ–‡ä»¶**: `packages/data-manager/src/entities/Order.ts`

æ–°å¢å­—æ®µï¼š
- `exchange?: string` - äº¤æ˜“æ‰€åç§°
- `realizedPnl?: Decimal` - å·²å®ç°ç›ˆäº
- `unrealizedPnl?: Decimal` - æœªå®ç°ç›ˆäº
- `averagePrice?: Decimal` - å¹³å‡æˆäº¤ä»·
- `commission?: Decimal` - æ‰‹ç»­è´¹
- `commissionAsset?: string` - æ‰‹ç»­è´¹å¸ç§

### âœ… 2. TypeOrmDataManager æ–°å¢æ–¹æ³•

**æ–‡ä»¶**: `packages/data-manager/src/TypeOrmDataManager.ts`

#### ç­–ç•¥ç®¡ç†æ–¹æ³•
- `createStrategy(data)` - åˆ›å»ºç­–ç•¥
- `getStrategy(id)` - è·å–å•ä¸ªç­–ç•¥
- `getStrategies(filters)` - è·å–ç­–ç•¥åˆ—è¡¨ï¼ˆæ”¯æŒæŒ‰ userId, status, exchange è¿‡æ»¤ï¼‰
- `updateStrategy(id, updates)` - æ›´æ–°ç­–ç•¥
- `deleteStrategy(id)` - åˆ é™¤ç­–ç•¥
- `updateStrategyStatus(id, status, errorMessage?)` - æ›´æ–°ç­–ç•¥çŠ¶æ€

#### è®¢å•ç®¡ç†æ–¹æ³•
- `saveOrder(order)` - ä¿å­˜è®¢å•
- `updateOrder(id, updates)` - æ›´æ–°è®¢å•
- `getOrder(id)` - è·å–å•ä¸ªè®¢å•
- `getOrders(filters)` - è·å–è®¢å•åˆ—è¡¨ï¼ˆæ”¯æŒæŒ‰ strategyId, symbol, status, æ—¥æœŸèŒƒå›´è¿‡æ»¤ï¼‰

#### PnL åˆ†ææ–¹æ³•
- `getStrategyPnL(strategyId)` - è·å–ç‰¹å®šç­–ç•¥çš„ PnL ç»Ÿè®¡
- `getOverallPnL(userId?)` - è·å–æ•´ä½“ PnL ç»Ÿè®¡ï¼ˆæŒ‰ç­–ç•¥åˆ†ç»„ï¼‰

### âœ… 3. Web API Endpoints

#### ç­–ç•¥ç®¡ç† API
**æ–‡ä»¶**: `apps/web/app/api/strategies/`

- `GET /api/strategies` - åˆ—å‡ºæ‰€æœ‰ç­–ç•¥
- `POST /api/strategies` - åˆ›å»ºæ–°ç­–ç•¥
- `GET /api/strategies/:id` - è·å–å•ä¸ªç­–ç•¥
- `PATCH /api/strategies/:id` - æ›´æ–°ç­–ç•¥
- `DELETE /api/strategies/:id` - åˆ é™¤ç­–ç•¥
- `POST /api/strategies/:id/status` - æ›´æ–°ç­–ç•¥çŠ¶æ€ï¼ˆå¯ç”¨/åœæ­¢ï¼‰

ç‰¹æ€§ï¼š
- ç”¨æˆ·è®¤è¯å’Œæˆæƒæ£€æŸ¥
- æ•°æ®éªŒè¯
- é”™è¯¯å¤„ç†ï¼ˆå”¯ä¸€çº¦æŸã€æƒé™æ£€æŸ¥ç­‰ï¼‰

#### åˆ†æå’Œè®¢å• API
**æ–‡ä»¶**: `apps/web/app/api/analytics/`, `apps/web/app/api/orders/`

- `GET /api/analytics/pnl` - è·å–æ•´ä½“ PnL
- `GET /api/analytics/pnl?strategyId=X` - è·å–ç‰¹å®šç­–ç•¥ PnL
- `GET /api/orders` - è·å–è®¢å•åˆ—è¡¨ï¼ˆæ”¯æŒå¤šç§è¿‡æ»¤æ¡ä»¶ï¼‰

#### æ•°æ®åº“è¿æ¥å·¥å…·
**æ–‡ä»¶**: `apps/web/lib/db.ts`

- å•ä¾‹æ¨¡å¼çš„ DataManager
- ç¯å¢ƒå˜é‡é…ç½®
- è‡ªåŠ¨åˆå§‹åŒ–

### âœ… 4. Web UI - ç­–ç•¥ç®¡ç†é¡µé¢

**æ–‡ä»¶**: `apps/web/app/strategy/page.tsx`

åŠŸèƒ½ï¼š
- æ˜¾ç¤ºæ‰€æœ‰ç­–ç•¥ï¼ˆå¡ç‰‡è§†å›¾ï¼‰
- åˆ›å»ºæ–°ç­–ç•¥ï¼ˆå¯¹è¯æ¡†è¡¨å•ï¼‰
- å¯åŠ¨/åœæ­¢ç­–ç•¥ï¼ˆçŠ¶æ€åˆ‡æ¢æŒ‰é’®ï¼‰
- åˆ é™¤ç­–ç•¥ï¼ˆä»…é™å·²åœæ­¢çš„ç­–ç•¥ï¼‰
- å®æ—¶çŠ¶æ€æ˜¾ç¤ºï¼ˆACTIVE, STOPPED, PAUSED, ERRORï¼‰
- æ˜¾ç¤ºæœ€åæ‰§è¡Œæ—¶é—´

UI ç»„ä»¶ï¼š
- å“åº”å¼ç½‘æ ¼å¸ƒå±€
- çŠ¶æ€å¾½ç« ï¼ˆä¸åŒé¢œè‰²ï¼‰
- è¡¨å•éªŒè¯ï¼ˆJSON å‚æ•°éªŒè¯ï¼‰
- Toast é€šçŸ¥

### âœ… 5. Web UI - åˆ†æå’Œ PnL é¡µé¢

**æ–‡ä»¶**: `apps/web/app/analytics/page.tsx`

åŠŸèƒ½ï¼š
- **PnL æ¦‚è§ˆå¡ç‰‡**:
  - Total PnL (Realized + Unrealized)
  - Realized PnL
  - Unrealized PnL
  - æ€»è®¢å•æ•°å’Œæˆäº¤æ•°
  
- **ç­–ç•¥ç­›é€‰å™¨**: æŸ¥çœ‹æ‰€æœ‰ç­–ç•¥æˆ–ç‰¹å®šç­–ç•¥çš„æ•°æ®

- **è®¢å•åˆ—è¡¨**:
  - å®Œæ•´çš„è®¢å•å†å²
  - æŒ‰æ—¶é—´æ’åº
  - æ˜¾ç¤ºç­–ç•¥ã€äº¤æ˜“å¯¹ã€ä¹°å–æ–¹å‘ã€ä»·æ ¼ã€æ•°é‡ã€çŠ¶æ€
  - PnL æ•°æ®ï¼ˆé¢œè‰²ç¼–ç ï¼šç»¿è‰²ä¸ºç›ˆåˆ©ï¼Œçº¢è‰²ä¸ºäºæŸï¼‰
  
- **æŒ‰ç­–ç•¥åˆ†ç»„çš„ PnL**:
  - æ¯ä¸ªç­–ç•¥çš„æ€» PnL
  - åˆ†åˆ«æ˜¾ç¤º Realized å’Œ Unrealized PnL

### âœ… 6. Console - ç­–ç•¥åŠ¨æ€ç®¡ç†å™¨

**æ–‡ä»¶**: `apps/console/src/strategy-manager.ts`

æ ¸å¿ƒåŠŸèƒ½ï¼š
- **å¯åŠ¨æ—¶åŠ è½½**: ä»æ•°æ®åº“åŠ è½½æ‰€æœ‰ `active` çŠ¶æ€çš„ç­–ç•¥
- **å®šæ—¶æ£€æŸ¥**: æ¯ç§’æ£€æŸ¥æ•°æ®åº“ä¸€æ¬¡
- **è‡ªåŠ¨æ·»åŠ **: æ£€æµ‹åˆ°æ–°çš„æ´»è·ƒç­–ç•¥æ—¶è‡ªåŠ¨æ·»åŠ åˆ° TradeEngine
- **è‡ªåŠ¨ç§»é™¤**: æ£€æµ‹åˆ°å·²åœæ­¢çš„ç­–ç•¥æ—¶è‡ªåŠ¨ä» TradeEngine ç§»é™¤
- **é”™è¯¯å¤„ç†**: ç­–ç•¥åŠ è½½å¤±è´¥æ—¶è‡ªåŠ¨æ ‡è®°ä¸º ERROR çŠ¶æ€

ç­–ç•¥å®ä¾‹åŒ–ï¼š
- åŸºäºç­–ç•¥ç±»å‹åˆ›å»ºç›¸åº”çš„ç­–ç•¥å®ä¾‹
- è‡ªåŠ¨é…ç½®è®¢é˜…å‚æ•°
- æ”¯æŒå¯æ‰©å±•çš„ç­–ç•¥ç±»å‹æ˜ å°„

### âœ… 7. Console - è®¢å•è¿½è¸ªå™¨

**æ–‡ä»¶**: `apps/console/src/order-tracker.ts`

ç›‘å¬çš„äº‹ä»¶ï¼š
- `OrderCreated` - è®¢å•åˆ›å»º
- `OrderFilled` - è®¢å•å®Œå…¨æˆäº¤
- `OrderPartiallyFilled` - è®¢å•éƒ¨åˆ†æˆäº¤
- `OrderCancelled` - è®¢å•å–æ¶ˆ
- `OrderRejected` - è®¢å•æ‹’ç»

åŠŸèƒ½ï¼š
- **è‡ªåŠ¨ä¿å­˜è®¢å•**: æ‰€æœ‰è®¢å•äº‹ä»¶è‡ªåŠ¨ä¿å­˜åˆ°æ•°æ®åº“
- **PnL è®¡ç®—**: 
  - è®¡ç®—å¹³å‡æˆäº¤ä»·
  - åŸºäºå¯¹æ‰‹è®¢å•è®¡ç®— Realized PnL
  - è·Ÿè¸ª Unrealized PnL
- **ç­–ç•¥å…³è”**: ä» clientOrderId æå–ç­–ç•¥ ID å¹¶å…³è”è®¢å•

### âœ… 8. Console ä¸»ç¨‹åºæ›´æ–°

**æ–‡ä»¶**: `apps/console/src/main.ts`

é‡å¤§æ”¹å˜ï¼š
- ç§»é™¤ç¡¬ç¼–ç çš„ç­–ç•¥
- é›†æˆ TypeOrmDataManager
- åˆå§‹åŒ– StrategyManager å’Œ OrderTracker
- æ•°æ®åº“è¿æ¥ç®¡ç†
- ä¼˜é›…å…³é—­ï¼ˆæ¸…ç†æ‰€æœ‰èµ„æºï¼‰

æ–°çš„å¯åŠ¨æµç¨‹ï¼š
1. è¿æ¥æ•°æ®åº“
2. åˆå§‹åŒ– RiskManager å’Œ PortfolioManager
3. åˆ›å»º TradingEngine
4. å¯åŠ¨ OrderTracker
5. æ·»åŠ äº¤æ˜“æ‰€
6. å¯åŠ¨ TradingEngine
7. å¯åŠ¨ StrategyManagerï¼ˆåŠ è½½ç­–ç•¥ï¼‰

### âœ… 9. UI ç»„ä»¶

åˆ›å»ºäº†ç¼ºå¤±çš„ shadcn/ui ç»„ä»¶ï¼š
- `components/ui/dialog.tsx` - å¯¹è¯æ¡†ç»„ä»¶
- `components/ui/textarea.tsx` - å¤šè¡Œæ–‡æœ¬è¾“å…¥ç»„ä»¶

### âœ… 10. æ–‡æ¡£

åˆ›å»ºäº†å®Œæ•´çš„æ–‡æ¡£ï¼š
- `STRATEGY_MANAGEMENT_GUIDE.md` - å®Œæ•´çš„åŠŸèƒ½æŒ‡å—å’Œ API å‚è€ƒ
- `QUICK_START.md` - å¿«é€Ÿå¼€å§‹æŒ‡å—
- `packages/data-manager/.env.example` - æ•°æ®åº“é…ç½®ç¤ºä¾‹

## æŠ€æœ¯æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      User (Browser)                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â”‚ HTTP
                        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                 Web Manager (Next.js)                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ /strategy          â”‚ /analytics                    â”‚  â”‚
â”‚  â”‚ - Create strategiesâ”‚ - View PnL                    â”‚  â”‚
â”‚  â”‚ - Start/Stop       â”‚ - View Orders                 â”‚  â”‚
â”‚  â”‚ - Delete           â”‚ - Filter by Strategy          â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚              API Routes                            â”‚  â”‚
â”‚  â”‚ - /api/strategies/*                                â”‚  â”‚
â”‚  â”‚ - /api/analytics/pnl                               â”‚  â”‚
â”‚  â”‚ - /api/orders                                      â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â”‚ TypeORM
                        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                PostgreSQL Database                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ Tables:                                            â”‚  â”‚
â”‚  â”‚ - strategies (status, type, parameters, etc.)     â”‚  â”‚
â”‚  â”‚ - orders (PnL, commission, average price, etc.)   â”‚  â”‚
â”‚  â”‚ - users, positions, order_fills, etc.             â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â”‚ TypeORM
                        â”‚ (æ¯ç§’è½®è¯¢)
                        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚            Console Application (Node.js)                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ StrategyManager                                    â”‚  â”‚
â”‚  â”‚ - Load active strategies                           â”‚  â”‚
â”‚  â”‚ - Monitor DB changes (1s interval)                 â”‚  â”‚
â”‚  â”‚ - Add/Remove strategies dynamically                â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                      â”‚                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ TradingEngine                                      â”‚  â”‚
â”‚  â”‚ - Execute strategies                               â”‚  â”‚
â”‚  â”‚ - Process market data                              â”‚  â”‚
â”‚  â”‚ - Generate signals                                 â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                      â”‚ Events                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ OrderTracker                                       â”‚  â”‚
â”‚  â”‚ - Listen to order events                           â”‚  â”‚
â”‚  â”‚ - Save orders to DB                                â”‚  â”‚
â”‚  â”‚ - Calculate PnL                                    â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚ REST/WebSocket
                       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Exchange (Binance)                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## æ•°æ®æµ

### åˆ›å»ºå’Œå¯åŠ¨ç­–ç•¥æµç¨‹
```
User â†’ Web UI â†’ POST /api/strategies â†’ DB (strategies table, status=stopped)
User â†’ Web UI â†’ POST /api/strategies/:id/status â†’ DB (update status=active)
Console â†’ StrategyManager (æ£€æµ‹åˆ°æ–°æ´»è·ƒç­–ç•¥) â†’ TradingEngine.addStrategy()
Console â†’ Exchange (è®¢é˜…å¸‚åœºæ•°æ®)
Exchange â†’ TradingEngine â†’ Strategy.analyze()
Strategy â†’ Signal â†’ TradingEngine.executeOrder()
TradingEngine â†’ EventBus â†’ OrderTracker â†’ DB (ä¿å­˜è®¢å•å’ŒPnL)
```

### åœæ­¢ç­–ç•¥æµç¨‹
```
User â†’ Web UI â†’ POST /api/strategies/:id/status â†’ DB (update status=stopped)
Console â†’ StrategyManager (æ£€æµ‹åˆ°å·²åœæ­¢ç­–ç•¥) â†’ TradingEngine.removeStrategy()
```

### æŸ¥çœ‹ PnL æµç¨‹
```
User â†’ Web UI (/analytics) â†’ GET /api/analytics/pnl â†’ DB (èšåˆæŸ¥è¯¢)
DB â†’ API â†’ Web UI (æ˜¾ç¤º PnL æ•°æ®)
```

## å…³é”®è®¾è®¡å†³ç­–

### 1. è½®è¯¢ vs WebSocket
- **é€‰æ‹©**: è½®è¯¢ï¼ˆæ¯ç§’ï¼‰
- **åŸå› **: ç®€å•å¯é ï¼Œå¯¹äºç­–ç•¥ç®¡ç†çš„åœºæ™¯è¶³å¤Ÿï¼ˆä¸éœ€è¦å®æ—¶æ€§åˆ°æ¯«ç§’çº§ï¼‰
- **æœªæ¥æ”¹è¿›**: å¯ä»¥æ·»åŠ  WebSocket æ”¯æŒå®æ—¶çŠ¶æ€æ›´æ–°

### 2. PnL è®¡ç®—
- **å½“å‰å®ç°**: ç®€åŒ–ç‰ˆæœ¬ï¼ŒåŸºäºå¯¹æ‰‹è®¢å•
- **å­˜å‚¨**: åœ¨è®¢å•çº§åˆ«å­˜å‚¨ realized/unrealized PnL
- **æœªæ¥æ”¹è¿›**: å®ç°å®Œæ•´çš„æŒä»“è·Ÿè¸ªå’Œ FIFO/LIFO è®¡ç®—

### 3. ç­–ç•¥å®ä¾‹åŒ–
- **æ–¹å¼**: åŸºäºç±»å‹çš„å·¥å‚æ¨¡å¼
- **æ‰©å±•æ€§**: æ˜“äºæ·»åŠ æ–°ç­–ç•¥ç±»å‹
- **éªŒè¯**: åœ¨åˆ›å»ºæ—¶éªŒè¯å‚æ•° JSON

### 4. é”™è¯¯å¤„ç†
- **ç­–ç•¥é”™è¯¯**: è‡ªåŠ¨æ ‡è®°ä¸º ERROR çŠ¶æ€ï¼ŒåŒ…å«é”™è¯¯ä¿¡æ¯
- **è®¢å•é”™è¯¯**: è®°å½•æ—¥å¿—ä½†ä¸ä¸­æ–­ç³»ç»Ÿ
- **æ•°æ®åº“é”™è¯¯**: é‡è¯•æœºåˆ¶ï¼ˆé€šè¿‡ TypeORMï¼‰

## ä½¿ç”¨çš„æŠ€æœ¯æ ˆ

### Backend
- **TypeORM** - ORM å’Œæ•°æ®åº“è¿ç§»
- **PostgreSQL** - å…³ç³»å‹æ•°æ®åº“
- **Node.js** - Runtime
- **TypeScript** - ç±»å‹å®‰å…¨

### Frontend
- **Next.js 15** - React æ¡†æ¶
- **React 19** - UI åº“
- **shadcn/ui** - UI ç»„ä»¶
- **Tailwind CSS** - æ ·å¼
- **Radix UI** - æ— éšœç¢ UI åŸè¯­
- **Better Auth** - è®¤è¯

### Trading Engine
- **EventBus** - äº‹ä»¶é©±åŠ¨æ¶æ„
- **Decimal.js** - ç²¾ç¡®æ•°å€¼è®¡ç®—
- **è‡ªå®šä¹‰æ¶æ„** - TradingEngine, Strategy, Exchange ç­‰

## æµ‹è¯•å»ºè®®

### å•å…ƒæµ‹è¯•
- [ ] StrategyManager.createStrategyInstance()
- [ ] OrderTracker.calculatePnL()
- [ ] TypeOrmDataManager CRUD æ–¹æ³•
- [ ] API endpoint æˆæƒé€»è¾‘

### é›†æˆæµ‹è¯•
- [ ] ç­–ç•¥åˆ›å»ºå’Œå¯åŠ¨æµç¨‹
- [ ] è®¢å•äº‹ä»¶å¤„ç†å’Œä¿å­˜
- [ ] PnL è®¡ç®—å‡†ç¡®æ€§
- [ ] å¤šç­–ç•¥å¹¶å‘æ‰§è¡Œ

### E2E æµ‹è¯•
- [ ] Web UI å®Œæ•´æµç¨‹ï¼ˆåˆ›å»ºâ†’å¯åŠ¨â†’æŸ¥çœ‹â†’åœæ­¢â†’åˆ é™¤ï¼‰
- [ ] Console è‡ªåŠ¨åŠ è½½å’ŒåŒæ­¥
- [ ] æ•°æ®ä¸€è‡´æ€§æ£€æŸ¥

## å·²çŸ¥é™åˆ¶å’Œæœªæ¥æ”¹è¿›

### å½“å‰é™åˆ¶
1. **PnL è®¡ç®—**: ç®€åŒ–ç‰ˆæœ¬ï¼Œä¸æ”¯æŒå¤æ‚çš„æŒä»“ç®¡ç†
2. **è½®è¯¢å»¶è¿Ÿ**: æœ€å¤š 1 ç§’å»¶è¿Ÿæ£€æµ‹ç­–ç•¥å˜åŒ–
3. **ç­–ç•¥ç±»å‹**: ç›®å‰åªå®ç°äº† MovingAverageStrategy
4. **å•äº¤æ˜“æ‰€**: è™½ç„¶æ¶æ„æ”¯æŒå¤šäº¤æ˜“æ‰€ï¼Œä½†å½“å‰åªé…ç½®äº† Binance

### æœªæ¥æ”¹è¿›
1. **å®æ—¶åŒæ­¥**: ä½¿ç”¨ WebSocket æˆ–æ•°æ®åº“è§¦å‘å™¨å®ç°å®æ—¶ç­–ç•¥æ›´æ–°
2. **å®Œæ•´ PnL**: å®ç° FIFO/LIFO æŒä»“è·Ÿè¸ªå’Œå‡†ç¡®çš„ PnL è®¡ç®—
3. **æ›´å¤šç­–ç•¥**: æ·»åŠ  RSI, MACD, Bollinger Bands ç­‰ç­–ç•¥
4. **å¤šäº¤æ˜“æ‰€**: æ”¯æŒå¤šä¸ªäº¤æ˜“æ‰€å¹¶å‘æ‰§è¡Œ
5. **æ€§èƒ½ç›‘æ§**: æ·»åŠ ç­–ç•¥æ€§èƒ½æŒ‡æ ‡ï¼ˆèƒœç‡ã€æœ€å¤§å›æ’¤ç­‰ï¼‰
6. **é£é™©æ§åˆ¶**: å¢å¼ºé£é™©ç®¡ç†è§„åˆ™å’Œé™åˆ¶
7. **å›æµ‹é›†æˆ**: åœ¨ Web UI ä¸­å¯ç”¨ç­–ç•¥å›æµ‹åŠŸèƒ½
8. **é€šçŸ¥ç³»ç»Ÿ**: ç­–ç•¥ä¿¡å·ã€è®¢å•æˆäº¤ã€é”™è¯¯çš„é€šçŸ¥ï¼ˆé‚®ä»¶/çŸ­ä¿¡/Webhookï¼‰

## é…ç½®æ–‡ä»¶

éœ€è¦åˆ›å»ºçš„é…ç½®æ–‡ä»¶ï¼š

1. **`packages/data-manager/.env`**
   ```env
   DATABASE_HOST=localhost
   DATABASE_PORT=5432
   DATABASE_USER=postgres
   DATABASE_PASSWORD=your_password
   DATABASE_NAME=itrade
   DATABASE_SSL=false
   ```

2. **`apps/web/.env.local`**
   - æ•°æ®åº“é…ç½®ï¼ˆä¸ä¸Šé¢ç›¸åŒï¼‰
   - Better Auth é…ç½®
   - SMTP é…ç½®ï¼ˆå¦‚æœéœ€è¦é‚®ä»¶åŠŸèƒ½ï¼‰

## è¿ç§»æ­¥éª¤

ä»ç°æœ‰ç³»ç»Ÿè¿ç§»åˆ°æ–°ç³»ç»Ÿï¼š

### 1. å‡†å¤‡æ•°æ®åº“
```bash
cd packages/data-manager
cp .env.example .env
# ç¼–è¾‘ .env
pnpm exec tsx sync-scheme-to-db.ts
```

### 2. å®‰è£…ä¾èµ–
```bash
# åœ¨é¡¹ç›®æ ¹ç›®å½•
pnpm install
```

### 3. æ„å»ºåŒ…
```bash
pnpm build
```

### 4. è¿ç§»ç°æœ‰ç­–ç•¥ï¼ˆæ‰‹åŠ¨ï¼‰
- åœ¨ Web UI ä¸­é‡æ–°åˆ›å»ºç°æœ‰ç­–ç•¥
- æˆ–ç¼–å†™è¿ç§»è„šæœ¬

### 5. æ›´æ–° Console å¯åŠ¨è„šæœ¬
- ä¸å†éœ€è¦ç¡¬ç¼–ç ç­–ç•¥
- ç¡®ä¿ `.env` æ–‡ä»¶å­˜åœ¨

### 6. æµ‹è¯•
- åˆ›å»ºæµ‹è¯•ç­–ç•¥
- éªŒè¯å¯åŠ¨/åœæ­¢åŠŸèƒ½
- æ£€æŸ¥è®¢å•ä¿å­˜
- ç¡®è®¤ PnL è®¡ç®—

## æ€»ç»“

âœ… **å·²å®Œæˆçš„å·¥ä½œ**:
- å®Œæ•´çš„æ•°æ®åº“ schema æ›´æ–°
- TypeORM CRUD æ–¹æ³•
- Web API endpointsï¼ˆç­–ç•¥ç®¡ç†ã€PnL åˆ†æã€è®¢å•æŸ¥è¯¢ï¼‰
- Web UIï¼ˆç­–ç•¥ç®¡ç†é¡µé¢ã€åˆ†æé¢æ¿ï¼‰
- Console ç­–ç•¥åŠ¨æ€ç®¡ç†å™¨
- Console è®¢å•è¿½è¸ªå™¨
- å®Œæ•´çš„æ–‡æ¡£

ğŸ¯ **å®ç°çš„ç›®æ ‡**:
- âœ… åœ¨ Web Manager ç®¡ç†ç­–ç•¥ï¼ˆåˆ›å»ºã€å¯ç”¨ã€åœæ­¢ï¼‰
- âœ… Console å¯åŠ¨æ—¶è¯»å–æ•°æ®åº“ä¸­çš„æ´»è·ƒç­–ç•¥
- âœ… Console å®šæ—¶æ£€æŸ¥å¹¶åŒæ­¥ç­–ç•¥çŠ¶æ€
- âœ… ä¿å­˜è®¢å•å’Œ PnL æ•°æ®åˆ°æ•°æ®åº“
- âœ… åœ¨ Web Manager æŸ¥çœ‹ PnL ç»Ÿè®¡å’Œè®¢å•åˆ†æ

ğŸš€ **ç³»ç»Ÿå·²å°±ç»ª**: å¯ä»¥ç«‹å³å¼€å§‹ä½¿ç”¨ï¼

