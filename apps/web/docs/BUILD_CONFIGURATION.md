# Next.js Build Configuration Guide

æœ¬æŒ‡å—ä»‹ç»å¦‚ä½•ä½¿ç”¨ä¸åŒçš„æ„å»ºè¾“å‡ºç›®å½•æ¥é˜²æ­¢æ„å»ºäº§ç‰©ç›¸äº’è¦†ç›–ã€‚

## ğŸ—ï¸ æ„å»ºç›®å½•é…ç½®

### è¾“å‡ºç›®å½•æ˜ å°„

| æ„å»ºæ¨¡å¼ | è¾“å‡ºç›®å½• | ç”¨é€” |
|---------|---------|------|
| é»˜è®¤ | `.next` | é»˜è®¤æ„å»ºè¾“å‡º |
| dev | `.next-dev` | å¼€å‘ç¯å¢ƒæ„å»º |
| staging | `.next-staging` | é¢„å‘å¸ƒç¯å¢ƒæ„å»º |
| prod | `.next-prod` | ç”Ÿäº§ç¯å¢ƒæ„å»º |

## ğŸ“ å¯ç”¨å‘½ä»¤

### å¼€å‘æ¨¡å¼
```bash
# å¼€å‘æœåŠ¡å™¨ï¼ˆä½¿ç”¨ .next-dev ç›®å½•ï¼‰
pnpm dev

# æ¸…ç†åå¯åŠ¨å¼€å‘æœåŠ¡å™¨
pnpm dev:clean
```

### æ„å»ºå‘½ä»¤
```bash
# é»˜è®¤æ„å»ºï¼ˆä½¿ç”¨ .next ç›®å½•ï¼‰
pnpm build

# å¼€å‘ç¯å¢ƒæ„å»ºï¼ˆä½¿ç”¨ .next-dev ç›®å½•ï¼‰
pnpm build:dev

# é¢„å‘å¸ƒç¯å¢ƒæ„å»ºï¼ˆä½¿ç”¨ .next-staging ç›®å½•ï¼‰
pnpm build:staging

# ç”Ÿäº§ç¯å¢ƒæ„å»ºï¼ˆä½¿ç”¨ .next-prod ç›®å½•ï¼‰
pnpm build:prod
```

### å¯åŠ¨æœåŠ¡å™¨
```bash
# é»˜è®¤å¯åŠ¨ï¼ˆç«¯å£ 3002ï¼‰
pnpm start

# å¼€å‘ç¯å¢ƒå¯åŠ¨ï¼ˆç«¯å£ 3002ï¼‰
pnpm start:dev

# é¢„å‘å¸ƒç¯å¢ƒå¯åŠ¨ï¼ˆç«¯å£ 3003ï¼‰
pnpm start:staging

# ç”Ÿäº§ç¯å¢ƒå¯åŠ¨ï¼ˆç«¯å£ 3004ï¼‰
pnpm start:prod
```

### æ¸…ç†å‘½ä»¤
```bash
# æ¸…ç†æ‰€æœ‰æ„å»ºç›®å½•
pnpm clean

# æ¸…ç†ç‰¹å®šç¯å¢ƒçš„æ„å»ºç›®å½•
pnpm clean:dev
pnpm clean:staging
pnpm clean:prod
```

## ğŸ”§ å·¥ä½œæµç¤ºä¾‹

### åœºæ™¯1ï¼šå¹¶è¡Œå¼€å‘å’Œæµ‹è¯•
```bash
# ç»ˆç«¯1ï¼šå¼€å‘ç¯å¢ƒ
pnpm dev
# åº”ç”¨è¿è¡Œåœ¨ http://localhost:3000ï¼Œä½¿ç”¨ .next-dev ç›®å½•

# ç»ˆç«¯2ï¼šæ„å»ºå¹¶æµ‹è¯•é¢„å‘å¸ƒç‰ˆæœ¬
pnpm build:staging
pnpm start:staging
# åº”ç”¨è¿è¡Œåœ¨ http://localhost:3003ï¼Œä½¿ç”¨ .next-staging ç›®å½•
```

### åœºæ™¯2ï¼šä¿æŒå¤šä¸ªæ„å»ºç‰ˆæœ¬
```bash
# æ„å»ºæ‰€æœ‰ç¯å¢ƒç‰ˆæœ¬
pnpm build:dev
pnpm build:staging  
pnpm build:prod

# ç°åœ¨ä½ æœ‰ä¸‰ä¸ªç‹¬ç«‹çš„æ„å»ºè¾“å‡ºï¼š
# .next-dev/     - å¼€å‘ç‰ˆæœ¬
# .next-staging/ - é¢„å‘å¸ƒç‰ˆæœ¬
# .next-prod/    - ç”Ÿäº§ç‰ˆæœ¬

# å¯ä»¥éšæ—¶å¯åŠ¨ä»»ä½•ç‰ˆæœ¬
pnpm start:dev      # ç«¯å£ 3002
pnpm start:staging  # ç«¯å£ 3003
pnpm start:prod     # ç«¯å£ 3004
```

### åœºæ™¯3ï¼šCI/CD æµæ°´çº¿
```bash
# åœ¨ä¸åŒçš„ CI é˜¶æ®µä½¿ç”¨ä¸åŒçš„æ„å»ºå‘½ä»¤
# å¼€å‘åˆ†æ”¯
BUILD_MODE=dev pnpm build

# é¢„å‘å¸ƒåˆ†æ”¯
BUILD_MODE=staging pnpm build

# ç”Ÿäº§åˆ†æ”¯
BUILD_MODE=prod pnpm build
```

## âš™ï¸ ç¯å¢ƒå˜é‡

å¯ä»¥é€šè¿‡ `BUILD_MODE` ç¯å¢ƒå˜é‡æ§åˆ¶æ„å»ºè¾“å‡ºç›®å½•ï¼š

```bash
# æ‰‹åŠ¨è®¾ç½®æ„å»ºæ¨¡å¼
BUILD_MODE=staging next build
BUILD_MODE=prod next dev
```

æ”¯æŒçš„ `BUILD_MODE` å€¼ï¼š
- `dev` - ä½¿ç”¨ `.next-dev` ç›®å½•
- `staging` - ä½¿ç”¨ `.next-staging` ç›®å½•  
- `prod` - ä½¿ç”¨ `.next-prod` ç›®å½•
- æœªè®¾ç½® - ä½¿ç”¨é»˜è®¤ `.next` ç›®å½•

## ğŸ“ é¡¹ç›®ç»“æ„

```
apps/web/
â”œâ”€â”€ .next/          # é»˜è®¤æ„å»ºè¾“å‡º
â”œâ”€â”€ .next-dev/      # å¼€å‘ç¯å¢ƒæ„å»º
â”œâ”€â”€ .next-staging/  # é¢„å‘å¸ƒç¯å¢ƒæ„å»º
â”œâ”€â”€ .next-prod/     # ç”Ÿäº§ç¯å¢ƒæ„å»º
â”œâ”€â”€ next.config.ts  # Next.js é…ç½®æ–‡ä»¶
â””â”€â”€ package.json    # åŒ…å«æ‰€æœ‰æ„å»ºè„šæœ¬
```

## ğŸš€ ä¼˜åŠ¿

1. **é˜²æ­¢è¦†ç›–**: ä¸åŒç¯å¢ƒçš„æ„å»ºè¾“å‡ºåˆ†ç¦»ï¼Œé¿å…ç›¸äº’è¦†ç›–
2. **å¹¶è¡Œå¼€å‘**: å¯ä»¥åŒæ—¶è¿è¡Œå¼€å‘å’Œæµ‹è¯•ç¯å¢ƒ
3. **å¿«é€Ÿåˆ‡æ¢**: é¢„æ„å»ºå¤šä¸ªç‰ˆæœ¬ï¼Œå¿«é€Ÿå¯åŠ¨ä»»æ„ç¯å¢ƒ
4. **CI/CD å‹å¥½**: æ”¯æŒè‡ªåŠ¨åŒ–éƒ¨ç½²æµæ°´çº¿
5. **è°ƒè¯•ä¾¿åˆ©**: ä¿ç•™æ‰€æœ‰ç‰ˆæœ¬çš„æ„å»ºäº§ç‰©ä¾¿äºé—®é¢˜è¿½è¸ª

## ğŸ” æ•…éšœæ’é™¤

### ç«¯å£å†²çª
å¦‚æœé‡åˆ°ç«¯å£å ç”¨ï¼Œå¯ä»¥æ‰‹åŠ¨æŒ‡å®šç«¯å£ï¼š
```bash
BUILD_MODE=dev next start --port 3005
```

### æ„å»ºç¼“å­˜é—®é¢˜
æ¸…ç†ç‰¹å®šç¯å¢ƒçš„æ„å»ºç¼“å­˜ï¼š
```bash
pnpm clean:dev
pnpm build:dev
```

### ç¯å¢ƒå˜é‡ä¸ç”Ÿæ•ˆ
ç¡®ä¿åœ¨å‘½ä»¤è¡Œä¸­æ­£ç¡®è®¾ç½®ç¯å¢ƒå˜é‡ï¼š
```bash
# Linux/macOS
BUILD_MODE=staging pnpm build

# Windows
set BUILD_MODE=staging && pnpm build
```

---

**Author**: xiaoweihsueh@gmail.com  
**Date**: December 10, 2024  
**Version**: 1.0
